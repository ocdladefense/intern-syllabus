{"version":3,"file":"script-compiled.js","names":["View","vNode","VirtualDom","React","hooks","idx","root","useState","initialValue","state","_idx","setState","newVal","useEffect","cb","deps","oldDeps","hasChanged","some","dep","i","Object","is","workLoop","update","MyComponent","setTimeout","renderIndex","render","Component","selector","oldHooks","console","log","createRoot","count","setCount","\"Fragment\"","onclick"],"sources":["sample.js"],"sourcesContent":["/** @jsx vNode */ /** @jsxFrag \"Fragment\" */\n\nimport { View, vNode, VirtualDom } from \"./node_modules/@ocdla/view/view.js\";\n// import {createElement, render} from \"@ocdla/view\";\n\nconst React = (function () {\n  let hooks = [];\n  let idx = 0;\n  let root = null;\n\n  function useState(initialValue) {\n    const state = hooks[idx] || initialValue;\n\n    const _idx = idx;\n    const setState = (newVal) => {\n      hooks[_idx] = newVal;\n    };\n\n    idx++;\n\n    return [state, setState];\n  }\n\n  function useEffect(cb, deps) {\n    let oldDeps = hooks[idx];\n    let hasChanged = true;\n\n    if (oldDeps) {\n      hasChanged = deps.some((dep, i) => !Object.is(dep, oldDeps[i]));\n    }\n\n    if (hasChanged) cb();\n    hooks[idx] = deps;\n    idx++;\n  }\n\n  function workLoop() {\n    idx = 0;\n    root.update(<MyComponent />);\n    setTimeout(workLoop, 300);\n  }\n\n  let renderIndex = 0;\n\n  function render(Component, selector, oldHooks) {\n    oldHooks = oldHooks || [];\n    console.log(oldHooks, hooks);\n    let vNode = Component();\n    let hasChanged = hooks.some((dep, i) => !Object.is(dep, oldHooks[i]));\n    idx = 0;\n    // let root = document.querySelector(selector);\n\n    if (renderIndex === 0) {\n      root = View.createRoot(selector);\n    }\n    // root.innerHTML = \"\";\n    // const c = Component();\n    // c.render();\n\n    // let node = View.createElement(vNode);\n    // root.appendChild(node);\n    if (renderIndex === 0) {\n      root.render(vNode);\n    } else if (renderIndex > 0 && hasChanged) {\n      root.update(vNode);\n    }\n\n    renderIndex++;\n    oldHooks = hooks;\n    // return c;\n    setTimeout(() => render(Component, selector, oldHooks), 750);\n  }\n\n  return { useState, useEffect, vNode, render };\n})();\n\nfunction MyComponent() {\n  const [count, setCount] = React.useState(1);\n  // const [text, setText] = React.useState(\"Hello\");\n\n  /*React.useEffect(() => {\n    console.log(\"Will do something when count changes\");\n  }, [count]);\n  */\n  /*\n  return {\n    render: () => console.log([count, text]),\n    click: () => {\n      setCount(count + 1);\n    },\n    type: (c) => setText(c),\n  };\n  */\n  console.log(\"count\", count);\n  return (\n    <>\n      <h1>{\"Hello, world!\"}</h1>\n      <><span>hello</span><span>goodbye</span></>\n      <button onclick={() => setCount(count + 1)}>{\"Click me:\" + count}</button>\n    </>\n  );\n}  \n\nReact.render(MyComponent, \"#main\");\n\n/*\nwindow.App = root.render(MyComponent);\nApp.click();\nApp = React.render(MyComponent);\nApp.click();\nApp.type(\"how are you?\");\nApp = React.render(MyComponent);\n*/\n"],"mappings":"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","ignoreList":[]}